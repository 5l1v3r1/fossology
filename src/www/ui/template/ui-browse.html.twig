{% extends "include/base.html.twig" %}

{% block content %}
  {{ parent() }}
  
  <table border="1" width="100%">
    <tr>
      <td valign='top' width='20%'>
        <div style="text-align:center;font-size: large;">{{ 'Folder Navigation'|trans }}</div>
        {{ folderNav }}
      </td>
      <td valign="top">
        <div style="text-align:center;font-size: large;">{{ 'Uploads'|trans }}</div>

      <table class="semibordered" id="browsetbl" width="100%" cellpadding="0">
      <thead>
       <tr>
         <th id="insert_browsetbl_filter"></th>
         <th> 
           <select id="statusSelector" onchange="filterStatus();">
             <option value="0" selected> </option>
          {% for key,disp in statusOptions %}
            <option value="{{ key }}" {%if key == select %} selected{% endif %}>{{ disp }}</option>
          {% endfor %}
           </select>
         </th>
         <th></th>
         <th>{{ assigneeFilter }}</th>
         <th></th>
         <th></th>
       </tr>
       <tr><th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr>
      </thead>
      <tbody></tbody>
      <tfoot></tfoot>
      </table>

    </td></tr>
  </table>
{% endblock %}

{% block foot %}
  {{ parent() }}
  <script src="scripts/jquery.dataTables.js" type="text/javascript"></script>
  <script src="scripts/browse.js" type="text/javascript"></script>
  <script src="scripts/jquery.plainmodal.min.js" type="text/javascript"></script>
  <script src="scripts/tools.js" type="text/javascript"></script>

  <script type="text/javascript">

    tableColumns = [
      {"sTitle": "{{ "Upload Name and Description" }}", "sClass": "left"},
      {"sTitle": "{{ "Status" }}", "sClass": "center", "bSearchable": false},
      {
        "sTitle": "{{ "Comment" }}", "sClass": "center", "bSortable": false, "bSearchable": false,
        "mRender": function (source, type, val) {
          return commentColumn(source, type, val);
        }
      },
      {"sTitle": "{{ "Assigned to" }}", "sClass": "center", "bSearchable": false},
      {"sTitle": "{{ "Upload Date" }}", "sClass": "center", "sType": "string", "bSearchable": false},
      {
        "sTitle": "{{ "Priority" }}", "sClass": "center priobucket", "bSearchable": false,
        "mRender": function (source, type, val) {
          return prioColumn(source, type, val);
        }
      }
    ];

    tableSorting = [
      [5, "desc"],
      [0, "asc"],
      [3, "desc"],
      [1, "desc"],
      [4, "desc"]
    ];

    dataTableConfig =
        {
          "bServerSide": true,
          "sAjaxSource": "?mod=browse-processPost",
          "fnServerData": function (sSource, aoData, fnCallback) {
              aoData.push({"name": "folder", "value": "{{ folder }}"});
              aoData.push({"name": "show", "value": "{{ show }}"});
            aoData.push({"name": "assigneeSelected", "value": assigneeSelected});
            aoData.push({"name": "statusSelected", "value": statusSelected});
            $.getJSON(sSource, aoData, fnCallback).fail(failed);
          },
          "aoColumns": tableColumns,
          "aaSorting": tableSorting,
          "iDisplayLength": 50,
          "bProcessing": true,
          "bStateSave": true,
          "sCookiePrefix": "fossology_",
          "bRetrieve": true
            };

    function createBrowseTable() {
      var otable = $('#browsetbl').dataTable(dataTableConfig);
      return otable;
    }

    $(document).ready(function () {
      createBrowseTable();
    });

  </script>
{% endblock %}
