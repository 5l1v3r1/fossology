{% extends "include/base.html.twig" %}

{% block content %}
  {{ parent() }}
  <h3 id="jobResult"></h3>
{% endblock %}

{% block foot %}
  {{ parent() }}

  <script src="scripts/job-queue-poll.js" type="text/javascript"></script>
  <script>
    var resultEntity = $("#jobResult");

    function linkDownloadReport() {
      resultEntity.html("<a href='{{ downloadLink }}'>Download {{ reportType }}</a>");
    }
    function genereationFailed(jqPk) {
      var text = (jqPk > 0) ? linkToJob(jqPk) : "no job scheduled";
      resultEntity.html("{{ reportType }} generation failed: " + text);
    }

    function addLinkAndQueueAjaxPolling() {
      var jqPk = {{ jqPk }};
      if (jqPk > 0)
      {
        resultEntity.html("{{ reportType }} generation scheduled as " + linkToJob(jqPk));
        queueUpdateCheck(jqPk, linkDownloadReport, genereationFailed);
      }
      else
      {
        genereationFailed();
      }
    }

    $(document).ready(function () {
      addLinkAndQueueAjaxPolling();
    });
  </script>
{% endblock %}
