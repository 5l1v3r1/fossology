#!/bin/sh
# mkbsamcache - use Filter_License to generate the License.bsam cache
# Copyright (C) 2008 Hewlett-Packard Development Company, L.P.

# first clean up any previous failed attempts
if [ -f "{$PROJECTSTATEDIR}/agents/License.bsam.new" ]; then
   rm -f {$PROJECTSTATEDIR}/agents/License.bsam.new
fi

# Create cached files
cd {$AGENTDATADIR}/licenses/
find . -type f | sed -e 's@^./@@' | grep -v \.meta | sort | while read i ; do
   echo "Processing $i"
   {$AGENTDIR}/Filter_License -O "$i" >> {$PROJECTSTATEDIR}/agents/License.bsam.new
done

# Move the new one in to place
mv {$PROJECTSTATEDIR}/agents/License.bsam.new {$PROJECTSTATEDIR}/agents/License.bsam

